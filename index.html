<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AETHER CHRONICLE</title>

<link rel="manifest" href="manifest.json" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon.png">

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Orbitron:wght@500;900&family=Zen+Old+Mincho&family=Noto+Sans+JP:wght@100;400&display=swap" rel="stylesheet">

<style>
/* === デザイン変数 (茶色は廃止) === */
:root {
    --bg-void: #080808;
    --neon-cyan: #00f3ff;
    --neon-pink: #ff0055;
    --neon-purple: #bc13fe;
    --silver-metal: #e0e5eb;
    --glass: rgba(20, 20, 30, 0.6);
}

body {
    margin: 0;
    background-color: var(--bg-void);
    color: #fff;
    font-family: 'Orbitron', sans-serif;
    overflow-x: hidden;
    height: 100vh;
    width: 100vw;
    -webkit-touch-callout: none;
    user-select: none;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* === 背景 (動く霧 + グリッド) === */
.bg-layer {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: -2;
    background: radial-gradient(circle at center, #1a1a2e 0%, #000 90%);
}
.grid-bg {
    position: absolute;
    width: 200%; height: 200%;
    background-image: 
        linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px);
    animation: gridMove 20s linear infinite;
}
@keyframes gridMove { from { transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px); } to { transform: perspective(500px) rotateX(60deg) translateY(40px) translateZ(-200px); } }

/* 背景の歯車（シルエットのみ） */
.gear-bg {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 90vw; height: 90vw;
    opacity: 0.05;
    fill: var(--silver-metal);
    animation: rotateGear 60s linear infinite;
    z-index: -1;
    pointer-events: none;
}
@keyframes rotateGear { to { transform: translate(-50%, -50%) rotate(360deg); } }

/* === 1. 上部：実用ショートカット (Shortcut Dock) === */
.top-dock {
    width: 100%;
    padding: 20px 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
    display: flex;
    justify-content: center;
    gap: 15px;
    z-index: 100;
}

.icon-btn {
    position: relative;
    width: 65px; height: 65px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    backdrop-filter: blur(5px);
    transition: 0.3s;
    overflow: hidden;
}
.icon-btn:hover {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 15px var(--neon-cyan);
    transform: translateY(5px);
}
.icon-btn i { font-size: 20px; margin-bottom: 5px; color: var(--silver-metal); }
.icon-label { font-size: 9px; color: #aaa; letter-spacing: 1px; }

/* === 2. 中央：時計 (Chrono Core) === */
.main-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 100%;
    position: relative;
}

/* 魔法陣のような時計サークル */
.clock-circle {
    position: relative;
    width: 260px; height: 260px;
    display: flex;
    justify-content: center;
    align-items: center;
}
/* 外周リング */
.ring-outer {
    position: absolute;
    width: 100%; height: 100%;
    border: 1px dashed var(--neon-purple);
    border-radius: 50%;
    animation: spin 30s linear infinite reverse;
    opacity: 0.5;
}
.ring-inner {
    position: absolute;
    width: 80%; height: 80%;
    border: 2px solid var(--neon-cyan);
    border-radius: 50%;
    border-top-color: transparent;
    border-bottom-color: transparent;
    animation: spin 10s linear infinite;
    box-shadow: 0 0 10px var(--neon-cyan);
}
@keyframes spin { to { transform: rotate(360deg); } }

/* 時刻表示 */
.time-box {
    text-align: center;
    z-index: 10;
}
#time-text {
    font-size: 56px;
    font-weight: 900;
    color: #fff;
    text-shadow: 0 0 10px var(--neon-cyan), 0 0 30px var(--neon-cyan);
    letter-spacing: 2px;
    line-height: 1;
}
#date-text {
    font-family: 'Cinzel', serif;
    font-size: 14px;
    color: var(--neon-pink);
    letter-spacing: 4px;
    margin-top: 5px;
}
#sub-text {
    font-family: 'Zen Old Mincho', serif;
    font-size: 11px;
    color: #aaa;
    margin-top: 5px;
    opacity: 0.8;
}

/* 検索バー */
.search-container {
    width: 80%;
    max-width: 400px;
    margin-top: 30px;
    position: relative;
}
#search {
    width: 100%;
    background: transparent;
    border: none;
    border-bottom: 2px solid var(--silver-metal);
    color: #fff;
    font-family: 'Orbitron';
    font-size: 18px;
    padding: 10px;
    text-align: center;
    outline: none;
    transition: 0.3s;
}
#search:focus {
    border-color: var(--neon-pink);
    box-shadow: 0 4px 10px -2px rgba(255, 0, 85, 0.5);
}
#search::placeholder { color: rgba(255,255,255,0.3); font-size: 14px; }

/* === 3. 下部：ウィジェットグリッド (Widget Deck) === */
.widget-deck {
    width: 100%;
    max-width: 500px;
    padding: 20px;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-bottom: 20px;
    box-sizing: border-box;
}

.widget {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 90px;
    position: relative;
    overflow: hidden;
}
.widget-label {
    font-size: 10px;
    color: var(--neon-cyan);
    letter-spacing: 1px;
    text-transform: uppercase;
}

/* 天気ウィジェット */
.weather-main {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 5px;
}
.temp-big { font-size: 28px; font-weight: bold; text-shadow: 0 0 5px #fff; }
.weather-icon { font-size: 24px; }
.loc-small { font-size: 9px; color: #888; margin-top: 5px; }

/* コンパス（レーダー風） */
.radar-circle {
    width: 50px; height: 50px;
    border: 1px solid #444;
    border-radius: 50%;
    position: absolute;
    bottom: 10px; right: 10px;
    background: radial-gradient(circle, transparent 20%, rgba(0, 243, 255, 0.1));
}
.radar-line {
    position: absolute;
    top: 50%; left: 50%;
    width: 50%; height: 1px;
    background: var(--neon-pink);
    transform-origin: 0 0;
    transform: rotate(-90deg); /* JSで制御 */
    box-shadow: 0 0 5px var(--neon-pink);
    transition: transform 0.5s ease;
}

/* システム負荷（蒸気メーター改めCPUグラフ） */
.bar-container {
    display: flex;
    align-items: flex-end;
    gap: 2px;
    height: 40px;
    margin-top: 10px;
}
.bar {
    flex: 1;
    background: var(--neon-purple);
    opacity: 0.5;
    transition: height 0.2s;
}

/* サブカルログ */
.log-stream {
    font-family: 'Zen Old Mincho', serif;
    font-size: 10px;
    color: #aaa;
    line-height: 1.4;
    white-space: pre-wrap;
    opacity: 0.7;
}

/* === アニメーション＆エフェクト === */
.glitch { animation: glitch-anim 3s infinite; }
@keyframes glitch-anim {
    0% { transform: translate(0); }
    2% { transform: translate(-2px, 2px); }
    4% { transform: translate(2px, -2px); }
    6% { transform: translate(0); }
}

</style>
</head>
<body>

    <div class="bg-layer">
        <div class="grid-bg"></div>
        <svg class="gear-bg" viewBox="0 0 100 100">
             <path d="M50 0 L56 10 L68 8 L72 20 L84 18 L88 30 L100 30 L94 40 L100 50 L94 60 L100 70 L88 70 L84 82 L72 80 L68 92 L56 90 L50 100 L44 90 L32 92 L28 80 L16 82 L12 70 L0 70 L6 60 L0 50 L6 40 L0 30 L12 30 L16 18 L28 20 L32 8 L44 10 Z" />
        </svg>
    </div>

    <div class="top-dock">
        <div class="icon-btn" onclick="openLink('https://youtube.com')">
            <div style="font-size:24px; color:#f00;">▶</div>
            <div class="icon-label">YOUTUBE</div>
        </div>
        <div class="icon-btn" onclick="openLink('https://google.com')">
            <div style="font-size:24px; color:#4285F4;">G</div>
            <div class="icon-label">GOOGLE</div>
        </div>
        <div class="icon-btn" onclick="openLink('https://x.com')">
            <div style="font-size:24px; color:#fff;">X</div>
            <div class="icon-label">NETWORK</div>
        </div>
        <div class="icon-btn" onclick="openLink('https://chatgpt.com')">
            <div style="font-size:24px; color:#10a37f;">✦</div>
            <div class="icon-label">AI CORE</div>
        </div>
    </div>

    <div class="main-section">
        <div class="clock-circle">
            <div class="ring-outer"></div>
            <div class="ring-inner"></div>
            
            <div class="time-box">
                <div id="time-text" class="glitch">00:00</div>
                <div id="date-text">XXXX.XX.XX</div>
                <div id="sub-text">世界線変動率 0.000%</div>
            </div>
        </div>

        <div class="search-container">
            <input type="text" id="search" placeholder=">> ENTER COMMAND CODE...">
        </div>
    </div>

    <div class="widget-deck">
        <div class="widget" onclick="initWeather()">
            <div class="widget-label">ATMOSPHERE</div>
            <div class="weather-main">
                <div class="temp-big" id="temp">--°</div>
                <div class="weather-icon" id="w-icon">☁</div>
            </div>
            <div class="loc-small" id="loc">SCANNING...</div>
        </div>

        <div class="widget">
            <div class="widget-label">COMPASS / RADAR</div>
            <div class="radar-circle">
                <div class="radar-line" id="compass-line"></div>
            </div>
            <div style="margin-top:15px; font-size:12px;" id="compass-text">N</div>
        </div>

        <div class="widget">
            <div class="widget-label">SYSTEM LOAD</div>
            <div class="bar-container" id="load-bars">
                </div>
        </div>

        <div class="widget">
            <div class="widget-label">SYSTEM LOG</div>
            <div class="log-stream" id="log-text">
                Connection established.<br>Waiting for input...
            </div>
        </div>
    </div>

    <script>
        // === 1. 時計 & サブカル演出 ===
        function updateClock() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            
            document.getElementById('time-text').innerText = `${h}:${m}`;
            
            const days = ['SUN','MON','TUE','WED','THU','FRI','SAT'];
            document.getElementById('date-text').innerText = 
                `${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')} [${days[now.getDay()]}]`;

            // たまに「世界線変動率」を変える（中二病演出）
            if (Math.random() > 0.95) {
                const rate = (Math.random() * 2 + 0.5).toFixed(6);
                document.getElementById('sub-text').innerText = `世界線変動率 ${rate}%`;
            }
        }
        setInterval(updateClock, 1000);
        updateClock();

        // === 2. 天気予報 (Open-Meteo) ===
        async function fetchWeather(lat, lon) {
            try {
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`;
                const res = await fetch(url);
                const data = await res.json();
                
                const temp = Math.round(data.current_weather.temperature);
                const code = data.current_weather.weathercode;
                
                document.getElementById('temp').innerText = `${temp}°C`;
                document.getElementById('loc').innerText = `LAT:${lat.toFixed(2)} LON:${lon.toFixed(2)}`;
                
                let icon = "☁";
                if(code === 0) icon = "☀";
                else if(code <= 3) icon = "⛅";
                else if(code <= 67) icon = "☂";
                else if(code <= 86) icon = "❄";
                else icon = "⛈";
                document.getElementById('w-icon').innerText = icon;

            } catch (e) {
                document.getElementById('loc').innerText = "OFFLINE";
            }
        }

        function initWeather() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => fetchWeather(pos.coords.latitude, pos.coords.longitude),
                    (err) => fetchWeather(35.6895, 139.6917) // デフォルト東京
                );
            } else {
                fetchWeather(35.6895, 139.6917);
            }
        }
        initWeather();
        setInterval(initWeather, 600000); // 10分更新

        // === 3. コンパス (スマホ対応) ===
        if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', (event) => {
                if(event.alpha) {
                    // 北を0度としてレーダーを回転
                    const deg = event.alpha; 
                    document.getElementById('compass-line').style.transform = `rotate(${deg - 90}deg)`;
                    document.getElementById('compass-text').innerText = Math.round(deg) + "°";
                }
            });
        }

        // === 4. システム負荷バー生成 ===
        const barContainer = document.getElementById('load-bars');
        for(let i=0; i<10; i++) {
            const bar = document.createElement('div');
            bar.className = 'bar';
            bar.style.height = Math.random() * 100 + "%";
            barContainer.appendChild(bar);
        }
        setInterval(() => {
            const bars = document.querySelectorAll('.bar');
            bars.forEach(b => {
                b.style.height = Math.random() * 100 + "%";
                // 色をランダムで変化（シアンorピンク）
                b.style.background = Math.random() > 0.5 ? "var(--neon-cyan)" : "var(--neon-pink)";
            });
        }, 800);

        // === 5. ランダムログ生成（サブカル/ダーク） ===
        const logs = [
            "境界線上のノイズを検知",
            "エーテル圧力が上昇中...",
            "観測者：UNKNOWN",
            "記憶領域の断片化を確認",
            "第三次プロトコル始動",
            "シュレディンガーの猫を捜索中",
            "Void Engine: STABLE"
        ];
        setInterval(() => {
            const randLog = logs[Math.floor(Math.random() * logs.length)];
            const time = new Date().toLocaleTimeString();
            document.getElementById('log-text').innerHTML = `[${time}]<br>${randLog}`;
        }, 4000);

        // === 6. リンク & 検索 ===
        function openLink(url) { window.location.href = url; }
        
        const sBox = document.getElementById('search');
        sBox.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const q = sBox.value;
                if(q) location.href = `https://www.google.com/search?q=${encodeURIComponent(q)}`;
            }
        });

        // PWA
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("service-worker.js");
        }
    </script>
</body>
</html>
