<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AETHER CHRONICLE</title>

<link rel="manifest" href="manifest.json" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon.png">

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Orbitron:wght@500;900&family=Zen+Old+Mincho&display=swap" rel="stylesheet">

<style>
/* === CORE VARIABLES === */
:root {
    --bg-void: #080808;
    --neon-cyan: #00f3ff;
    --neon-pink: #ff0055;
    --neon-purple: #bc13fe;
    --silver-metal: #e0e5eb;
    --glass: rgba(10, 10, 15, 0.85);
    --border: rgba(255, 255, 255, 0.15);
}

body {
    margin: 0;
    background-color: var(--bg-void);
    color: #fff;
    font-family: 'Orbitron', sans-serif;
    overflow: hidden; /* „É¢„Éº„ÉÄ„É´Â±ïÈñã„ÅÆ„Åü„ÇÅ„Çπ„ÇØ„É≠„Éº„É´Âà∂Âæ° */
    height: 100vh;
    width: 100vw;
    -webkit-touch-callout: none;
    user-select: none;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* === BACKGROUND === */
.bg-layer {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
    background: radial-gradient(circle at center, #1a1a2e 0%, #000 90%);
}
.grid-bg {
    position: absolute;
    width: 200%; height: 200%;
    background-image: 
        linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px);
    animation: gridMove 20s linear infinite;
}
@keyframes gridMove { from { transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px); } to { transform: perspective(500px) rotateX(60deg) translateY(40px) translateZ(-200px); } }
.gear-bg {
    position: fixed; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 90vw; height: 90vw; opacity: 0.05;
    fill: var(--silver-metal);
    animation: rotateGear 60s linear infinite;
    z-index: -1; pointer-events: none;
}
@keyframes rotateGear { to { transform: translate(-50%, -50%) rotate(360deg); } }

/* === 1. TOP SHORTCUTS (Maintained) === */
.top-dock {
    width: 100%; padding: 15px 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
    display: flex; justify-content: center; gap: 12px;
    z-index: 10;
}
.icon-btn {
    width: 65px; height: 65px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--border);
    border-radius: 14px;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    text-decoration: none; color: #fff;
    backdrop-filter: blur(5px);
    transition: 0.3s;
}
.icon-btn:hover { border-color: var(--neon-cyan); box-shadow: 0 0 15px var(--neon-cyan); }
.icon-symbol { font-size: 20px; margin-bottom: 4px; color: var(--silver-metal); }
.icon-label { font-size: 9px; color: #aaa; letter-spacing: 0.5px; }

/* === 2. CENTER CLOCK (Maintained) === */
.main-section {
    flex: 1; display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    width: 100%; position: relative;
    padding-bottom: 20px;
}
.clock-circle {
    position: relative; width: 240px; height: 240px;
    display: flex; justify-content: center; align-items: center;
}
.ring-outer {
    position: absolute; width: 100%; height: 100%;
    border: 1px dashed var(--neon-purple); border-radius: 50%;
    animation: spin 30s linear infinite reverse; opacity: 0.5;
}
.ring-inner {
    position: absolute; width: 80%; height: 80%;
    border: 2px solid var(--neon-cyan); border-radius: 50%;
    border-top-color: transparent; border-bottom-color: transparent;
    animation: spin 10s linear infinite; box-shadow: 0 0 10px var(--neon-cyan);
}
@keyframes spin { to { transform: rotate(360deg); } }

.time-box { text-align: center; z-index: 10; }
#time-text {
    font-size: 56px; font-weight: 900; color: #fff;
    text-shadow: 2px 0 var(--neon-cyan), -2px 0 var(--neon-pink);
    letter-spacing: 2px; line-height: 1;
}
.glitch-effect { animation: glitch-skew 2s infinite linear alternate-reverse; }
@keyframes glitch-skew {
    0% { transform: skew(0deg); }
    2% { transform: skew(-2deg); }
    4% { transform: skew(2deg); }
    6% { transform: skew(0deg); }
}
#date-text { font-family: 'Cinzel', serif; font-size: 13px; color: var(--neon-pink); letter-spacing: 3px; margin-top: 8px; }

/* === 3. APP LAUNCHER (New Design) === */
.launcher-grid {
    width: 100%; max-width: 500px;
    display: grid; grid-template-columns: repeat(2, 1fr);
    gap: 12px; padding: 0 20px 20px 20px;
    box-sizing: border-box;
}
.app-card {
    height: 90px;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px;
    position: relative; overflow: hidden;
    cursor: pointer; transition: 0.2s;
    display: flex; flex-direction: column; justify-content: space-between;
}
.app-card:active { transform: scale(0.98); background: rgba(0, 243, 255, 0.1); }
.app-title { font-size: 10px; color: var(--neon-cyan); letter-spacing: 1px; }
.app-icon-bg {
    position: absolute; right: 5px; bottom: 5px;
    font-size: 40px; opacity: 0.2; color: #fff;
}
.app-status { font-family: 'Zen Old Mincho'; font-size: 10px; color: #888; }

/* === STATUS BAR (Weather & Credit) === */
.status-bar {
    width: 100%; height: 30px;
    background: #000;
    border-top: 1px solid #333;
    display: flex; justify-content: space-between; align-items: center;
    padding: 0 15px; box-sizing: border-box;
    font-size: 10px; color: #aaa;
    z-index: 20;
}
.status-item span { color: var(--neon-cyan); margin-left: 5px; }

/* === MODAL OVERLAYS (The Apps) === */
.modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.95);
    backdrop-filter: blur(10px);
    z-index: 200;
    transform: translateY(110%);
    transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    display: flex; flex-direction: column;
}
.modal.active { transform: translateY(0); }

.modal-header {
    padding: 20px;
    border-bottom: 1px solid var(--neon-pink);
    display: flex; justify-content: space-between; align-items: center;
    background: linear-gradient(90deg, #110005, transparent);
}
.modal-title { font-size: 18px; color: var(--neon-pink); letter-spacing: 2px; }
.close-btn { font-size: 24px; color: #fff; cursor: pointer; }

.modal-content {
    flex: 1; padding: 20px; overflow-y: auto;
    display: flex; flex-direction: column; gap: 15px;
}

/* -- MODULE 1: QUEST BOARD -- */
.quest-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px; border: 1px solid #333; border-radius: 4px;
    background: rgba(255,255,255,0.02);
}
.quest-checkbox {
    width: 20px; height: 20px; border: 2px solid var(--neon-cyan);
    display: flex; justify-content: center; align-items: center;
    cursor: pointer;
}
.quest-checkbox.checked { background: var(--neon-cyan); box-shadow: 0 0 10px var(--neon-cyan); }
.quest-text { flex: 1; font-family: 'Zen Old Mincho'; font-size: 14px; }
.quest-rank { font-size: 10px; color: var(--neon-pink); border: 1px solid var(--neon-pink); padding: 2px 4px; }
#add-quest-btn {
    padding: 10px; background: transparent; border: 1px solid var(--neon-cyan);
    color: var(--neon-cyan); font-family: 'Orbitron'; cursor: pointer;
}

/* -- MODULE 2: TUNER -- */
.tuner-control {
    text-align: center; padding: 20px; border: 1px solid #444; border-radius: 8px;
}
.tuner-btn {
    width: 80px; height: 80px; border-radius: 50%;
    border: 2px solid var(--silver-metal); background: #111;
    color: #fff; font-size: 12px; margin: 20px auto;
    display: flex; justify-content: center; align-items: center; flex-direction: column;
    cursor: pointer; transition: 0.3s;
    box-shadow: 0 0 10px rgba(255,255,255,0.1);
}
.tuner-btn.active { border-color: var(--neon-cyan); box-shadow: 0 0 20px var(--neon-cyan); color: var(--neon-cyan); }
.freq-display { height: 40px; display: flex; align-items: flex-end; justify-content: center; gap: 3px; }
.freq-bar { width: 4px; background: var(--neon-cyan); animation: freqAnim 0.5s infinite; }
@keyframes freqAnim { 0%,100%{height:20%;} 50%{height:80%;} }

/* -- MODULE 3: VITAL -- */
.vital-circle {
    width: 200px; height: 200px; border-radius: 50%;
    border: 4px solid #333; margin: 20px auto;
    position: relative; display: flex; flex-direction: column;
    justify-content: center; align-items: center;
}
.vital-progress {
    position: absolute; top: -4px; left: -4px;
    width: 100%; height: 100%; border-radius: 50%;
    border: 4px solid transparent; border-top-color: var(--neon-pink);
    transform: rotate(45deg); transition: 1s linear;
}
.vital-time { font-size: 40px; font-weight: bold; text-shadow: 0 0 10px var(--neon-pink); }
.vital-btn {
    padding: 10px 30px; background: var(--neon-pink); border: none;
    color: #fff; font-family: 'Orbitron'; font-weight: bold;
    cursor: pointer; margin-top: 10px; box-shadow: 0 0 15px var(--neon-pink);
}

/* -- MODULE 4: ARCHIVE (Memo) -- */
.memo-area {
    width: 100%; height: 300px; background: #050505;
    border: 1px solid #333; padding: 10px; color: #ddd;
    font-family: 'Zen Old Mincho'; font-size: 13px; line-height: 1.6;
    resize: none; outline: none; white-space: pre-wrap;
}
.memo-toolbar { display: flex; gap: 10px; margin-bottom: 5px; }
.redact-btn { font-size: 10px; background: #333; border: none; color: #fff; padding: 5px; cursor: pointer; }

</style>
</head>
<body>

    <div class="bg-layer">
        <div class="grid-bg"></div>
        <svg class="gear-bg" viewBox="0 0 100 100"><path d="M50 0 L56 10 L68 8 L72 20 L84 18 L88 30 L100 30 L94 40 L100 50 L94 60 L100 70 L88 70 L84 82 L72 80 L68 92 L56 90 L50 100 L44 90 L32 92 L28 80 L16 82 L12 70 L0 70 L6 60 L0 50 L6 40 L0 30 L12 30 L16 18 L28 20 L32 8 L44 10 Z" /></svg>
    </div>

    <div class="top-dock">
        <a class="icon-btn" href="https://youtube.com"><div class="icon-symbol">‚ñ∂</div><div class="icon-label">YOUTUBE</div></a>
        <a class="icon-btn" href="https://gemini.google.com"><div class="icon-symbol">‚ú¶</div><div class="icon-label">GEMINI</div></a>
        <a class="icon-btn" href="https://music.apple.com"><div class="icon-symbol">‚ô´</div><div class="icon-label">MUSIC</div></a>
        <a class="icon-btn" href="https://maps.google.com"><div class="icon-symbol">üó∫</div><div class="icon-label">MAPS</div></a>
    </div>

    <div class="main-section">
        <div class="clock-circle">
            <div class="ring-outer"></div>
            <div class="ring-inner"></div>
            <div class="time-box">
                <div id="time-text" class="glitch-effect">00:00</div>
                <div id="date-text">----.--.--</div>
            </div>
        </div>
    </div>

    <div class="launcher-grid">
        <div class="app-card" onclick="openModal('modal-quest')">
            <div class="app-title">QUEST BOARD</div>
            <div class="app-status">Active Missions: <span id="mission-count">0</span></div>
            <div class="app-icon-bg">‚öî</div>
        </div>
        <div class="app-card" onclick="openModal('modal-tuner')">
            <div class="app-title">NOISE TUNER</div>
            <div class="app-status">Frequency: Ready</div>
            <div class="app-icon-bg">üì°</div>
        </div>
        <div class="app-card" onclick="openModal('modal-vital')">
            <div class="app-title">VITAL KEEPER</div>
            <div class="app-status">Condition: Normal</div>
            <div class="app-icon-bg">‚ô•</div>
        </div>
        <div class="app-card" onclick="openModal('modal-archive')">
            <div class="app-title">AKASHIC MEMO</div>
            <div class="app-status">Access: Granted</div>
            <div class="app-icon-bg">‚úí</div>
        </div>
    </div>

    <div class="status-bar">
        <div class="status-item" id="weather-status" onclick="window.open('https://weather.yahoo.co.jp/weather/jp/22/5010.html')">SHIZUOKA: --¬∞C</div>
        <div class="status-item">CREDITS: <span id="credit-val">0</span> G</div>
    </div>

    <div id="modal-quest" class="modal">
        <div class="modal-header"><span class="modal-title">QUEST BOARD</span><span class="close-btn" onclick="closeModal('modal-quest')">√ó</span></div>
        <div class="modal-content">
            <div style="font-size:12px; color:#aaa; margin-bottom:10px;">>> ‰ªªÂãô„ÇíÈÅ∏Êäû„Ç∑„ÉÜÂÆüË°å„Çª„É®</div>
            <div id="quest-list"></div>
            <button id="add-quest-btn" onclick="addQuest()">+ NEW MISSION</button>
        </div>
    </div>

    <div id="modal-tuner" class="modal">
        <div class="modal-header"><span class="modal-title">NOISE TUNER</span><span class="close-btn" onclick="closeModal('modal-tuner')">√ó</span></div>
        <div class="modal-content" style="align-items:center;">
            <div style="font-size:12px; color:#aaa;">>> Áí∞Â¢ÉÈü≥ÈüøÁîüÊàê„É¶„Éã„ÉÉ„Éà</div>
            <div class="tuner-control">
                <div class="freq-display" id="freq-viz">
                    </div>
                <div class="tuner-btn" id="noise-btn" onclick="toggleNoise()">
                    <div>I/O</div>
                    <div id="noise-status">OFF</div>
                </div>
                <div style="font-size:10px; margin-top:10px; color:#666;">TYPE: PINK NOISE (RAIN)</div>
            </div>
        </div>
    </div>

    <div id="modal-vital" class="modal">
        <div class="modal-header"><span class="modal-title">VITAL KEEPER</span><span class="close-btn" onclick="closeModal('modal-vital')">√ó</span></div>
        <div class="modal-content" style="align-items:center;">
            <div class="vital-circle">
                <div class="vital-progress" id="vital-ring"></div>
                <div class="vital-time" id="timer-display">25:00</div>
                <div style="font-size:10px; color:#aaa; margin-top:5px;">FOCUS CYCLE</div>
            </div>
            <button class="vital-btn" onclick="toggleTimer()" id="timer-btn">START LINK</button>
        </div>
    </div>

    <div id="modal-archive" class="modal">
        <div class="modal-header"><span class="modal-title">AKASHIC MEMO</span><span class="close-btn" onclick="closeModal('modal-archive')">√ó</span></div>
        <div class="modal-content">
            <div class="memo-toolbar">
                <button class="redact-btn" onclick="insertRedact()">‚ñ† ÈªíÂ°ó„ÇäÊåøÂÖ•</button>
            </div>
            <textarea class="memo-area" id="memo-field" placeholder="Ë®òÈå≤„ÇíÈñãÂßã..."></textarea>
            <div style="font-size:10px; color:#555;">‚ÄªÂÜÖÂÆπ„ÅØ„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´ÊöóÂè∑ÂåñÔºàÊØîÂñ©Ôºâ‰øùÂ≠ò„Åï„Çå„Åæ„Åô„ÄÇ</div>
        </div>
    </div>

    <script>
        // === CORE: Clock & Weather ===
        function updateClock() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('time-text').innerText = `${h}:${m}`;
            document.getElementById('date-text').innerText = now.toLocaleDateString();
        }
        setInterval(updateClock, 1000); updateClock();

        async function fetchWeather() {
            try {
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=34.9756&longitude=138.3828&current_weather=true');
                const data = await res.json();
                document.getElementById('weather-status').innerText = `SHIZUOKA: ${data.current_weather.temperature}¬∞C`;
            } catch(e) {}
        }
        fetchWeather(); setInterval(fetchWeather, 600000);

        // === MODAL SYSTEM ===
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        // === M1: QUEST BOARD (Credits) ===
        let credits = localStorage.getItem('credits') ? parseInt(localStorage.getItem('credits')) : 0;
        let quests = JSON.parse(localStorage.getItem('quests')) || [];
        updateCredits(); renderQuests();

        function updateCredits() {
            document.getElementById('credit-val').innerText = credits;
            localStorage.setItem('credits', credits);
        }
        function addQuest() {
            const txt = prompt("‰ªªÂãôÂÜÖÂÆπ„ÇíÂÖ•Âäõ (‰æã: ÁöøÊ¥ó„ÅÑË®é‰ºê)");
            if(txt) {
                quests.push({ text: txt, done: false });
                saveQuests(); renderQuests();
            }
        }
        function toggleQuest(index) {
            quests[index].done = !quests[index].done;
            if(quests[index].done) {
                credits += 100; // Â†±ÈÖ¨
                alert("Â†±ÈÖ¨Áç≤Âæó: 100 G");
            } else {
                credits -= 100;
            }
            updateCredits(); saveQuests(); renderQuests();
        }
        function saveQuests() { localStorage.setItem('quests', JSON.stringify(quests)); }
        function renderQuests() {
            const list = document.getElementById('quest-list');
            list.innerHTML = "";
            let activeCount = 0;
            quests.forEach((q, i) => {
                if(!q.done) activeCount++;
                const div = document.createElement('div');
                div.className = 'quest-item';
                div.innerHTML = `
                    <div class="quest-checkbox ${q.done ? 'checked' : ''}" onclick="toggleQuest(${i})">‚úî</div>
                    <div class="quest-text" style="${q.done ? 'text-decoration:line-through; opacity:0.5;' : ''}">${q.text}</div>
                    <div class="quest-rank">B</div>
                    <div style="font-size:10px; cursor:pointer;" onclick="deleteQuest(${i})">üóë</div>
                `;
                list.appendChild(div);
            });
            document.getElementById('mission-count').innerText = activeCount;
        }
        function deleteQuest(i) {
            if(confirm("‰ªªÂãôÁ†¥Ê£ÑÔºü")) { quests.splice(i,1); saveQuests(); renderQuests(); }
        }

        // === M2: NOISE TUNER (Web Audio API) ===
        let audioCtx, noiseNode, gainNode;
        let isNoiseOn = false;

        function initAudio() {
            if(!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        function toggleNoise() {
            initAudio();
            if(isNoiseOn) {
                // STOP
                gainNode.disconnect();
                isNoiseOn = false;
                document.getElementById('noise-status').innerText = "OFF";
                document.getElementById('noise-btn').classList.remove('active');
            } else {
                // START (Pink Noise Generator)
                const bufferSize = 4096;
                noiseNode = audioCtx.createScriptProcessor(bufferSize, 1, 1);
                noiseNode.onaudioprocess = function(e) {
                    const output = e.outputBuffer.getChannelData(0);
                    for (let i = 0; i < bufferSize; i++) {
                        const white = Math.random() * 2 - 1;
                        output[i] = (lastOut + (0.02 * white)) / 1.02; // Simple Pink Noise approx
                        lastOut = output[i];
                        output[i] *= 3.5; 
                    }
                };
                let lastOut = 0;
                gainNode = audioCtx.createGain();
                gainNode.gain.value = 0.1; // Volume
                noiseNode.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                isNoiseOn = true;
                document.getElementById('noise-status').innerText = "ON";
                document.getElementById('noise-btn').classList.add('active');
            }
        }
        // Visualizer bar (Fake)
        const viz = document.getElementById('freq-viz');
        for(let i=0; i<10; i++) {
            const b = document.createElement('div');
            b.className = 'freq-bar';
            b.style.height = Math.random()*100 + "%";
            b.style.animationDuration = (0.2 + Math.random()*0.5) + "s";
            viz.appendChild(b);
        }

        // === M3: VITAL KEEPER (Timer) ===
        let timerTime = 25 * 60;
        let timerInterval = null;
        function toggleTimer() {
            const btn = document.getElementById('timer-btn');
            if(timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                btn.innerText = "RESUME LINK";
            } else {
                btn.innerText = "LINK ESTABLISHED";
                timerInterval = setInterval(() => {
                    timerTime--;
                    if(timerTime <= 0) {
                        clearInterval(timerInterval);
                        alert("ÂÜ∑Âç¥ÂÆå‰∫Ü (‰ºëÊÜ©ÊôÇÈñì„Åß„Åô)");
                        timerTime = 5 * 60; // ‰ºëÊÜ©„Å∏
                    }
                    updateTimerDisplay();
                }, 1000);
            }
        }
        function updateTimerDisplay() {
            const m = Math.floor(timerTime / 60).toString().padStart(2,'0');
            const s = (timerTime % 60).toString().padStart(2,'0');
            document.getElementById('timer-display').innerText = `${m}:${s}`;
        }

        // === M4: ARCHIVE (Memo) ===
        const memoField = document.getElementById('memo-field');
        if(localStorage.getItem('archiveMemo')) {
            memoField.value = localStorage.getItem('archiveMemo');
        }
        memoField.addEventListener('input', () => {
            localStorage.setItem('archiveMemo', memoField.value);
        });
        function insertRedact() {
            const start = memoField.selectionStart;
            const end = memoField.selectionEnd;
            const text = memoField.value;
            const before = text.substring(0, start);
            const after = text.substring(end, text.length);
            memoField.value = before + " [REDACTED] " + after;
            localStorage.setItem('archiveMemo', memoField.value);
        }

        // Service Worker
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("service-worker.js");
        }
    </script>
</body>
</html>
