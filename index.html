<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AETHER CHRONICLE</title>

<link rel="manifest" href="manifest.json" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon.png">

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Orbitron:wght@500;900&family=Zen+Old+Mincho&display=swap" rel="stylesheet">

<style>
/* === CORE VARIABLES === */
:root {
    --bg-void: #050505;
    --neon-cyan: #00f3ff;
    --neon-pink: #ff0055;
    --neon-purple: #bc13fe;
    --neon-gold: #ffcc00;
    --forbidden-red: #ff3333; /* Á¶ÅÊõ∏Â∫´Áî® */
    --silver-metal: #e0e5eb;
    --glass: rgba(20, 20, 30, 0.6);
    --border: rgba(255, 255, 255, 0.15);
}

body {
    margin: 0;
    background-color: var(--bg-void);
    color: #fff;
    font-family: 'Orbitron', sans-serif;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
    -webkit-touch-callout: none;
    user-select: none;
    display: flex; flex-direction: column; align-items: center;
}

/* === BACKGROUND === */
.bg-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; background: radial-gradient(circle at center, #111 0%, #000 90%); }
.grid-bg { position: absolute; width: 200%; height: 200%; background-image: linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px); background-size: 40px 40px; transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px); animation: gridMove 20s linear infinite; }
@keyframes gridMove { from { transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px); } to { transform: perspective(500px) rotateX(60deg) translateY(40px) translateZ(-200px); } }

/* === SHORTCUTS === */
.top-dock { width: 100%; padding: 15px 0; display: flex; justify-content: center; gap: 12px; z-index: 10; }
.icon-btn { width: 60px; height: 60px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 12px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-decoration: none; color: #fff; backdrop-filter: blur(5px); transition: 0.3s; }
.icon-btn:hover { border-color: var(--neon-cyan); box-shadow: 0 0 15px var(--neon-cyan); }
.icon-symbol { font-size: 18px; margin-bottom: 4px; color: var(--silver-metal); }
.icon-label { font-size: 8px; color: #aaa; letter-spacing: 0.5px; }

/* === CLOCK === */
.main-section { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; position: relative; }
.clock-container { position: relative; width: 220px; height: 220px; display: flex; justify-content: center; align-items: center; }
.c-ring { position: absolute; border-radius: 50%; border: 1px solid transparent; }
.c-ring-1 { width: 100%; height: 100%; border-top-color: var(--neon-purple); border-bottom-color: var(--neon-purple); animation: spin 20s linear infinite; opacity: 0.6; }
.c-ring-2 { width: 80%; height: 80%; border-left-color: var(--neon-cyan); border-right-color: var(--neon-cyan); animation: spin 10s linear infinite reverse; box-shadow: 0 0 10px rgba(0,243,255,0.2); }
@keyframes spin { to { transform: rotate(360deg); } }
#time-text { font-size: 52px; font-weight: 900; color: #fff; text-shadow: 0 0 15px var(--neon-cyan); letter-spacing: 2px; line-height: 1; z-index: 5; }
#date-text { font-family: 'Cinzel', serif; font-size: 12px; color: var(--neon-pink); letter-spacing: 3px; margin-top: 5px; text-align: center; }

/* === MODULE GRID === */
.modules-container {
    width: 100%; max-width: 450px; padding: 0 20px 30px 20px;
    display: flex; flex-direction: column; gap: 12px; box-sizing: border-box;
    z-index: 10;
}

/* -- WEATHER WIDGET (New) -- */
.weather-card {
    width: 100%; height: 60px;
    background: linear-gradient(90deg, rgba(0, 243, 255, 0.05), rgba(0,0,0,0.8));
    border: 1px solid var(--neon-cyan); border-radius: 8px;
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 20px; box-sizing: border-box;
    cursor: pointer; position: relative; overflow: hidden;
    box-shadow: 0 0 10px rgba(0, 243, 255, 0.1);
}
.weather-card::before {
    content: "ATMOS SCAN"; position: absolute; top: 2px; left: 6px;
    font-size: 8px; color: var(--neon-cyan); letter-spacing: 1px; opacity: 0.7;
}
.w-temp { font-size: 24px; font-weight: bold; text-shadow: 0 0 5px var(--neon-cyan); }
.w-loc { font-size: 10px; color: #aaa; margin-left: 10px; }
.w-icon { font-size: 24px; }
.w-scan-line {
    position: absolute; top: 0; left: 0; width: 2px; height: 100%;
    background: var(--neon-cyan); opacity: 0.5; box-shadow: 0 0 10px var(--neon-cyan);
    animation: scan 4s ease-in-out infinite;
}
@keyframes scan { 0%{left:0;} 50%{left:100%;} 100%{left:0;} }

/* -- 2x2 GRID -- */
.app-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; }
.app-card {
    height: 90px; background: rgba(255,255,255,0.03);
    border: 1px solid var(--border); border-radius: 8px;
    padding: 10px; position: relative; overflow: hidden;
    cursor: pointer; transition: 0.2s;
    display: flex; flex-direction: column; justify-content: space-between;
}
.app-card:active { transform: scale(0.98); }
.app-title { font-size: 10px; color: var(--neon-cyan); letter-spacing: 1px; }
.app-icon-bg { position: absolute; right: 5px; bottom: 5px; font-size: 36px; opacity: 0.15; color: #fff; }
.app-status { font-family: 'Zen Old Mincho'; font-size: 10px; color: #888; }

/* Special Style for Forbidden Archive */
.card-forbidden { border-color: rgba(255, 51, 51, 0.3); }
.card-forbidden .app-title { color: var(--forbidden-red); }
.card-forbidden:hover { box-shadow: 0 0 15px rgba(255, 51, 51, 0.2); }

/* === FOOTER INFO === */
.footer-info { font-size: 10px; color: #555; text-align: center; width: 100%; padding-bottom: 5px; }
#credit-val { color: var(--neon-gold); font-weight: bold; }

/* === MODALS === */
.modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(5, 5, 8, 0.98); backdrop-filter: blur(15px);
    z-index: 200; transform: translateY(110%);
    transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    display: flex; flex-direction: column;
}
.modal.active { transform: translateY(0); }
.modal-header {
    padding: 15px 20px; border-bottom: 1px solid #333;
    display: flex; justify-content: space-between; align-items: center;
}
.modal-title { font-size: 16px; color: var(--neon-pink); letter-spacing: 2px; font-weight: bold; }
.close-btn { font-size: 24px; color: #fff; cursor: pointer; }
.modal-content { flex: 1; padding: 20px; overflow-y: auto; position: relative; }

/* -- FORBIDDEN ARCHIVE STYLES -- */
#modal-archive { background: radial-gradient(circle, #1a0000 0%, #000000 90%); }
#modal-archive .modal-title { color: var(--forbidden-red); text-shadow: 0 0 10px var(--forbidden-red); }
#modal-archive .modal-header { border-bottom: 1px solid var(--forbidden-red); }

.archive-container {
    display: flex; flex-direction: column; height: 100%;
}
.archive-controls {
    display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px;
}
.arch-btn {
    background: transparent; border: 1px solid var(--forbidden-red); color: var(--forbidden-red);
    padding: 8px 12px; font-family: 'Orbitron'; font-size: 10px; cursor: pointer;
    transition: 0.3s; flex: 1;
}
.arch-btn:hover { background: var(--forbidden-red); color: #000; box-shadow: 0 0 10px var(--forbidden-red); }

.archive-editor {
    flex: 1; background: rgba(20, 0, 0, 0.3); border: 1px solid #333;
    padding: 15px; color: #ccaaaa; font-family: 'Zen Old Mincho', serif;
    font-size: 14px; line-height: 1.8; outline: none; resize: none;
    white-space: pre-wrap; overflow-y: auto;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
}
.archive-editor::placeholder { color: #522; }

/* Encryption Animation Class */
.encrypted-text {
    font-family: 'Orbitron', monospace; color: var(--forbidden-red);
    text-shadow: 0 0 3px var(--forbidden-red); letter-spacing: 1px;
    pointer-events: none; /* ÊöóÂè∑Âåñ‰∏≠„ÅØÁ∑®ÈõÜ‰∏çÂèØ */
}

/* -- QUEST & OTHER STYLES (Simplified for space) -- */
.quest-input-area { display: flex; gap: 5px; margin-bottom: 15px; }
#quest-in-text { flex: 1; background: #111; border: 1px solid #333; color: #fff; padding: 8px; }
#quest-add-btn { background: var(--neon-cyan); border: none; padding: 0 15px; font-weight: bold; cursor: pointer; }
.quest-card { background: rgba(255,255,255,0.05); padding: 10px; margin-bottom: 5px; border-left: 3px solid #555; display: flex; justify-content: space-between; }
.quest-card.rank-s { border-color: var(--neon-gold); }

/* -- VITAL & TUNER (Simplified) -- */
.vital-pod { width: 180px; height: 180px; border-radius: 50%; border: 2px solid #333; margin: 20px auto; display: flex; justify-content: center; align-items: center; position: relative; }
.vital-ring { position: absolute; width: 100%; height: 100%; border-radius: 50%; border-top: 2px solid var(--neon-pink); animation: spin 4s linear infinite; }
.tuner-viz { width: 100%; height: 100px; background: #000; border: 1px solid #333; }

</style>
</head>
<body>

    <div class="bg-layer"><div class="grid-bg"></div></div>

    <div class="top-dock">
        <a class="icon-btn" href="https://youtube.com"><div class="icon-symbol">‚ñ∂</div><div class="icon-label">YOUTUBE</div></a>
        <a class="icon-btn" href="https://gemini.google.com"><div class="icon-symbol">‚ú¶</div><div class="icon-label">GEMINI</div></a>
        <a class="icon-btn" href="https://music.apple.com"><div class="icon-symbol">‚ô´</div><div class="icon-label">MUSIC</div></a>
        <a class="icon-btn" href="https://maps.google.com"><div class="icon-symbol">üó∫</div><div class="icon-label">MAPS</div></a>
    </div>

    <div class="main-section">
        <div class="clock-container">
            <div class="c-ring c-ring-1"></div>
            <div class="c-ring c-ring-2"></div>
            <div style="text-align:center; z-index:10;">
                <div id="time-text">00:00</div>
                <div id="date-text">--.--.--</div>
            </div>
        </div>
    </div>

    <div class="modules-container">
        <div class="weather-card" onclick="window.open('https://weather.yahoo.co.jp/weather/jp/22/5010.html')">
            <div class="w-scan-line"></div>
            <div style="display:flex; align-items:center;">
                <div class="w-icon" id="w-icon">‚òÅ</div>
                <div class="w-loc">SHIZUOKA<br><span style="font-size:8px; color:#666;">LIVE MONITOR</span></div>
            </div>
            <div class="w-temp" id="w-temp">--¬∞C</div>
        </div>

        <div style="height:10px;"></div>

        <div class="app-grid">
            <div class="app-card" onclick="openModal('modal-quest')">
                <div class="app-title">QUEST BOARD</div>
                <div class="app-status">Active: <span id="m-count">0</span></div>
                <div class="app-icon-bg">‚öî</div>
            </div>
            <div class="app-card" onclick="openModal('modal-tuner')">
                <div class="app-title">NOISE TUNER</div>
                <div class="app-status">Soundscape</div>
                <div class="app-icon-bg">üì°</div>
            </div>
            <div class="app-card" onclick="openModal('modal-vital')">
                <div class="app-title">VITAL KEEPER</div>
                <div class="app-status">Life Support</div>
                <div class="app-icon-bg">‚ô•</div>
            </div>
            <div class="app-card card-forbidden" onclick="openModal('modal-archive')">
                <div class="app-title">FORBIDDEN ARCHIVE</div>
                <div class="app-status" style="color:#aa5555;">[[ RESTRICTED ]]</div>
                <div class="app-icon-bg">üëÅ</div>
            </div>
        </div>
    </div>

    <div class="footer-info">CREDITS ACQUIRED: <span id="credit-val">0</span> G</div>

    <div id="modal-quest" class="modal">
        <div class="modal-header"><span class="modal-title">QUEST BOARD</span><span class="close-btn" onclick="closeModal('modal-quest')">√ó</span></div>
        <div class="modal-content">
            <div class="quest-input-area">
                <input type="text" id="quest-in-text" placeholder="Mission Name...">
                <button id="quest-add-btn" onclick="addQuest()">ADD</button>
            </div>
            <div id="quest-list"></div>
        </div>
    </div>

    <div id="modal-tuner" class="modal">
        <div class="modal-header"><span class="modal-title">NOISE TUNER</span><span class="close-btn" onclick="closeModal('modal-tuner')">√ó</span></div>
        <div class="modal-content">
            <canvas id="viz-canvas" class="tuner-viz"></canvas>
            <div style="display:flex; justify-content:center; margin-top:20px;">
                <button class="arch-btn" style="border-color:var(--neon-cyan); color:var(--neon-cyan);" onclick="toggleNoise()">I/O SWITCH</button>
            </div>
        </div>
    </div>

    <div id="modal-vital" class="modal">
        <div class="modal-header"><span class="modal-title">VITAL KEEPER</span><span class="close-btn" onclick="closeModal('modal-vital')">√ó</span></div>
        <div class="modal-content">
            <div class="vital-pod">
                <div class="vital-ring"></div>
                <div id="vital-timer" style="font-size:32px; font-weight:bold;">25:00</div>
            </div>
            <div style="text-align:center;">
                <button class="arch-btn" style="border-color:var(--neon-pink); color:var(--neon-pink);" onclick="startVital()">INITIATE LINK</button>
            </div>
        </div>
    </div>

    <div id="modal-archive" class="modal">
        <div class="modal-header">
            <span class="modal-title">FORBIDDEN ARCHIVE</span>
            <span class="close-btn" onclick="closeModal('modal-archive')">√ó</span>
        </div>
        <div class="modal-content">
            <div class="archive-container">
                <div class="archive-controls">
                    <button class="arch-btn" onclick="sealArchive()">üîí SEAL (ENCRYPT)</button>
                    <button class="arch-btn" onclick="unsealArchive()">üîì UNSEAL (DECRYPT)</button>
                    <button class="arch-btn" onclick="clearArchive()">üóë BURN</button>
                </div>
                <textarea id="archive-area" class="archive-editor" placeholder=">> Ë®òÈå≤„Éè „Ç≥„Ç≥„Éá ÈÄîÁµ∂„Ç®„ÉÜ„Ç§„É´..."></textarea>
                <div style="font-size:10px; color:#522; margin-top:5px; text-align:right;">SYSTEM: RED_PROTOCOL_ACTIVE</div>
            </div>
        </div>
    </div>

    <script>
        // === CLOCK ===
        function updateClock() {
            const now = new Date();
            document.getElementById('time-text').innerText = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
            document.getElementById('date-text').innerText = now.toLocaleDateString();
        }
        setInterval(updateClock, 1000); updateClock();

        // === WEATHER (ATMOS SCAN) ===
        async function fetchWeather() {
            try {
                // ÈùôÂ≤°Â∏Ç„ÅÆÂ∫ßÊ®ô
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=34.9756&longitude=138.3828&current_weather=true');
                const data = await res.json();
                const temp = data.current_weather.temperature;
                const code = data.current_weather.weathercode;
                
                document.getElementById('w-temp').innerText = `${temp}¬∞C`;
                
                // Â§©Ê∞ó„Ç≥„Éº„ÉâÁ∞°ÊòìÂ§âÊèõ
                let icon = "‚òÅ";
                if(code <= 1) icon = "‚òÄ";
                else if(code <= 3) icon = "‚õÖ";
                else if(code <= 60) icon = "‚òÅ";
                else icon = "‚òÇ";
                document.getElementById('w-icon').innerText = icon;

            } catch(e) {
                document.getElementById('w-temp').innerText = "ERR";
            }
        }
        fetchWeather();
        setInterval(fetchWeather, 600000); // 10ÂàÜÊõ¥Êñ∞

        // === MODALS ===
        function openModal(id) { document.getElementById(id).classList.add('active'); if(id==='modal-tuner') startViz(); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        // === ARCHIVE (Forbidden System) ===
        const archiveArea = document.getElementById('archive-area');
        let rawText = localStorage.getItem('forbiddenText') || "";
        let isSealed = false;

        // ÂàùÊúü„É≠„Éº„ÉâÊôÇ„ÅØÂπ≥Êñá„ÇíË°®Á§∫Ôºà„ÅäÂ•Ω„Åø„Åß„É≠„Éº„ÉâÊôÇ„ÇÇÊöóÂè∑ÂåñÂèØÔºâ
        archiveArea.value = rawText;

        function saveArchive() {
            if(!isSealed) {
                rawText = archiveArea.value;
                localStorage.setItem('forbiddenText', rawText);
            }
        }
        archiveArea.addEventListener('input', saveArchive);

        function sealArchive() {
            if(isSealed) return;
            isSealed = true;
            const len = rawText.length;
            let scrambled = "";
            const chars = "‚Ä†‚Ä°¬ß¬∂#@&%¬£¬¢¬•‚Ç¨ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            for(let i=0; i<len; i++) {
                if(rawText[i] === '\n') scrambled += '\n';
                else scrambled += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            archiveArea.value = scrambled;
            archiveArea.classList.add('encrypted-text');
            archiveArea.setAttribute('readonly', true);
        }

        function unsealArchive() {
            if(!isSealed) return;
            // „Éá„Ç≥„Éº„ÉâÊºîÂá∫
            let counter = 0;
            const interval = setInterval(() => {
                let temp = "";
                const chars = "0101010101";
                for(let i=0; i<rawText.length; i++) {
                    if(Math.random() > 0.5) temp += rawText[i];
                    else temp += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                archiveArea.value = temp;
                counter++;
                if(counter > 10) {
                    clearInterval(interval);
                    archiveArea.value = rawText;
                    archiveArea.classList.remove('encrypted-text');
                    archiveArea.removeAttribute('readonly');
                    isSealed = false;
                }
            }, 50);
        }

        function clearArchive() {
            if(confirm("ÂÆåÂÖ®Ê∂àÂéª„Ç∑„Éû„Çπ„Ç´Ôºü")) {
                rawText = "";
                archiveArea.value = "";
                isSealed = false;
                archiveArea.classList.remove('encrypted-text');
                archiveArea.removeAttribute('readonly');
                localStorage.setItem('forbiddenText', "");
            }
        }

        // === QUEST (Simple Logic) ===
        let quests = JSON.parse(localStorage.getItem('quests')) || [];
        let credits = parseInt(localStorage.getItem('credits')) || 0;
        document.getElementById('credit-val').innerText = credits;
        renderQuests();

        function addQuest() {
            const t = document.getElementById('quest-in-text').value;
            if(t) {
                quests.push({t:t, d:false});
                localStorage.setItem('quests', JSON.stringify(quests));
                renderQuests();
                document.getElementById('quest-in-text').value = "";
            }
        }
        function renderQuests() {
            const el = document.getElementById('quest-list');
            el.innerHTML = "";
            let cnt = 0;
            quests.forEach((q,i) => {
                if(!q.d) cnt++;
                const div = document.createElement('div');
                div.className = "quest-card";
                div.innerHTML = `<span>${q.t}</span><span onclick="delQuest(${i})">‚úî</span>`;
                el.appendChild(div);
            });
            document.getElementById('m-count').innerText = cnt;
        }
        function delQuest(i) {
            quests.splice(i,1);
            credits += 150;
            localStorage.setItem('credits', credits);
            localStorage.setItem('quests', JSON.stringify(quests));
            document.getElementById('credit-val').innerText = credits;
            renderQuests();
        }

        // === VITAL & TUNER (Minimal) ===
        function startVital() {
            let t = 25*60;
            const el = document.getElementById('vital-timer');
            const int = setInterval(()=>{
                t--;
                el.innerText = `${Math.floor(t/60)}:${String(t%60).padStart(2,'0')}`;
                if(t<=0) clearInterval(int);
            }, 1000);
        }

        let audioCtx;
        function toggleNoise() {
            if(!audioCtx) {
                audioCtx = new (window.AudioContext||window.webkitAudioContext)();
                // Á∞°Êòì„Éé„Ç§„Ç∫ÁîüÊàê
                const size = 4096;
                const node = audioCtx.createScriptProcessor(size, 1, 1);
                node.onaudioprocess = e => {
                    const out = e.outputBuffer.getChannelData(0);
                    for(let i=0; i<size; i++) out[i] = (Math.random()*2-1)*0.1;
                };
                node.connect(audioCtx.destination);
            } else {
                audioCtx.close();
                audioCtx = null;
            }
        }
        function startViz() {
            const cvs = document.getElementById('viz-canvas');
            const ctx = cvs.getContext('2d');
            cvs.width = cvs.clientWidth; cvs.height = cvs.clientHeight;
            function draw() {
                if(document.getElementById('modal-tuner').classList.contains('active')) requestAnimationFrame(draw);
                ctx.fillStyle="#000"; ctx.fillRect(0,0,cvs.width,cvs.height);
                ctx.strokeStyle="#0ff"; ctx.beginPath();
                ctx.moveTo(0,50);
                for(let i=0;i<cvs.width;i+=10) ctx.lineTo(i, 50+Math.sin(i*0.1+Date.now()*0.01)*20);
                ctx.stroke();
            }
            draw();
        }
    </script>
</body>
</html>
